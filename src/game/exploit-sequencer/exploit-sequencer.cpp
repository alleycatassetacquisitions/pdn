#include "game/exploit-sequencer/exploit-sequencer.hpp"
#include "game/exploit-sequencer/exploit-sequencer-states.hpp"

void ExploitSequencer::populateStateMap() {
    ExploitSequencerIntro* intro = new ExploitSequencerIntro(this);
    ExploitSequencerWin* win = new ExploitSequencerWin(this);
    ExploitSequencerLose* lose = new ExploitSequencerLose(this);

    // Stub: intro auto-transitions to win
    intro->addTransition(
        new StateTransition(
            std::bind(&ExploitSequencerIntro::transitionToWin, intro),
            win));

    // Standalone mode: win/lose loop back to intro for replay
    win->addTransition(
        new StateTransition(
            std::bind(&ExploitSequencerWin::transitionToIntro, win),
            intro));

    lose->addTransition(
        new StateTransition(
            std::bind(&ExploitSequencerLose::transitionToIntro, lose),
            intro));

    stateMap.push_back(intro);
    stateMap.push_back(win);
    stateMap.push_back(lose);
}

void ExploitSequencer::resetGame() {
    MiniGame::resetGame();
    session.reset();
}
